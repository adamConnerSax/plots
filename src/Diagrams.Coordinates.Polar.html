<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable         #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveGeneric              #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveTraversable          #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses      #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell            #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><a name="line-10"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Module      :  Diagrams.Coordinates.Spherical</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Copyright   :  (C) 2015 Christopher Chalmers</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- License     :  BSD-style (see the file LICENSE)</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Maintainer  :  Christopher Chalmers</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- Portability :  non-portable</span><span>
</span><a name="line-18"></a><span class="hs-comment">--</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- This module defines a polar coordinate data type. This type can be</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- used as an axis space for polar plots.</span><span>
</span><a name="line-21"></a><span class="hs-comment">--</span><span>
</span><a name="line-22"></a><span class="hs-comment">----------------------------------------------------------------------------</span><span>
</span><a name="line-23"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Diagrams</span><span class="hs-operator">.</span><span class="hs-identifier">Coordinates</span><span class="hs-operator">.</span><span class="hs-identifier">Polar</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Polar type</span><span>
</span><a name="line-25"></a><span>    </span><a href="Diagrams.Coordinates.Polar.html#Polar"><span class="hs-identifier hs-type">Polar</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#mkPolar"><span class="hs-identifier hs-var">mkPolar</span></a><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#polar"><span class="hs-identifier hs-var">polar</span></a><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#unpolar"><span class="hs-identifier hs-var">unpolar</span></a><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#polarIso"><span class="hs-identifier hs-var">polarIso</span></a><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#polarV2"><span class="hs-identifier hs-var">polarV2</span></a><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-comment">-- * Polar functions</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#interpPolar"><span class="hs-identifier hs-var">interpPolar</span></a><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>    </span><span class="hs-comment">-- * Classes</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#Radial"><span class="hs-identifier hs-type">Radial</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#Circle"><span class="hs-identifier hs-type">Circle</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#HasX"><span class="hs-identifier hs-type">HasX</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#HasY"><span class="hs-identifier hs-type">HasY</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HasR</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- * Basis elements</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#er"><span class="hs-identifier hs-var">er</span></a><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#e%3B8"><span class="hs-identifier hs-var">e&#952;</span></a><span class="hs-special">,</span><span> </span><a href="Diagrams.Coordinates.Polar.html#etheta"><span class="hs-identifier hs-var">etheta</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Lens</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Fix</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Zip</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Distributive</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Functor</span><span class="hs-operator">.</span><span class="hs-identifier">Rep</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC</span><span class="hs-operator">.</span><span class="hs-identifier">Generics</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic1</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Diagrams</span><span class="hs-operator">.</span><span class="hs-identifier">Angle</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Diagrams</span><span class="hs-operator">.</span><span class="hs-identifier">TwoD</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Linear</span><span class="hs-operator">.</span><span class="hs-identifier">Affine</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Linear</span><span class="hs-operator">.</span><span class="hs-identifier">Metric</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Linear</span><span class="hs-operator">.</span><span class="hs-identifier">V3</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Linear</span><span class="hs-operator">.</span><span class="hs-identifier">Vector</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><a href="Diagrams.Coordinates.Isomorphic.html"><span class="hs-identifier">Diagrams</span><span class="hs-operator">.</span><span class="hs-identifier">Coordinates</span><span class="hs-operator">.</span><span class="hs-identifier">Isomorphic</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">newtype</span><span> </span><a name="Polar"><a href="Diagrams.Coordinates.Polar.html#Polar"><span class="hs-identifier">Polar</span></a></a><span> </span><a name="local-1627477733"><a href="#local-1627477733"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Polar"><a href="Diagrams.Coordinates.Polar.html#Polar"><span class="hs-identifier">Polar</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">V2</span><span> </span><a href="#local-1627477733"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadFix</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>            </span><span class="hs-identifier hs-type">Generic1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadZip</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">F</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-identifier hs-var">makeWrapped</span><span> </span><span class="hs-char">''Polar

-- can't make reasonable Additive instance

instance Distributive Polar where
  distribute f = Polar $ V2 (fmap (\(Polar (V2 x _)) -&gt; x) f)
                            (fmap (\(Polar (V2 _ y)) -&gt; y) f)

instance Representable Polar where
  type Rep Polar = E Polar
  tabulate f     = Polar $ V2 (f er) (f e&#952;)
  index xs (E l) = view l xs

instance Circle Polar where
  _azimuth = polarWrapper . _y . from rad
  _polar   = id

instance HasR Polar where
  _r = polarWrapper . _x

-- | Construct a 'Polar' from a magnitude and an 'Angle'.
mkPolar :: n -&gt; Angle n -&gt; Polar n
mkPolar r &#952; = Polar $ V2 r (&#952;^.rad)

-- | Construct a 'Polar' from a magnitude and 'Angle' tuple.
polar :: (n, Angle n) -&gt; Polar n
polar = uncurry mkPolar

-- | Turn a 'Polar' back into a magnitude and 'Angle' tuple.
unpolar :: Polar n -&gt; (n, Angle n)
unpolar (Polar (V2 r &#952;)) = (r, &#952; @@ rad)

-- | 'Iso'' between 'Polar' and its tuple form.
polarIso :: Iso' (Polar n) (n, Angle n)
polarIso = iso unpolar polar

-- | Numerical 'Iso'' between 'Polar' and 'R2'.
polarV2 :: RealFloat n =&gt; Iso' (Polar n) (V2 n)
polarV2 = iso (\(Polar (V2 r &#952;)) -&gt; V2 (r * cos &#952;) (r * sin &#952;))
              (\v@(V2 x y)       -&gt; Polar $ V2 (norm v) (atan2 y x))

-- internal iso for instances
polarWrapper :: Iso' (Polar a) (V2 a)
polarWrapper = iso (\(Polar v) -&gt; v) Polar

-- | Polar interpolation between two polar coordinates.
interpPolar :: Num n =&gt; n -&gt; Polar n -&gt; Polar n -&gt; Polar n
interpPolar t (Polar a) (Polar b) = Polar (lerp t a b)


-- | Space which has a radial length basis. For Polar and Cylindrical this is
--   the radius of the circle in the xy-plane. For Spherical this is the
--   distance from the origin.
class Radial t where
  _radial :: Lens' (t a) a

instance Radial Polar where
  _radial = polarWrapper . _x

-- | Space which has a radial and angular basis.
class Radial t =&gt; Circle t where
  _azimuth :: Lens' (t a) (Angle a)
  _polar   :: Lens' (t a) (Polar a)

er :: Radial v =&gt; E v
er = E _radial

e&#952;, etheta :: Circle v =&gt; E v
e&#952;     = E (_polar . polarWrapper . _y)
etheta = e&#952;

-- | Coordinate with at least one dimension where the x coordinate can be
--   retreived numerically. Note this differs slightly from 'R1' which requires
--   a lens for all values. This allows instances for different coordinates
--   such as 'Polar', where the x coordinate can only be retreived numerically.
class HasX t where
  x_ :: RealFloat n =&gt; Lens' (t n) n

instance HasX v =&gt; HasX (Point v) where
  x_ = _Point . x_

instance HasX V2    where x_ = _x
instance HasX V3    where x_ = _x
instance HasX Polar where x_ = polarV2 . _x

-- | Coordinate with at least two dimensions where the x and y coordinates can be
--   retreived numerically.
class HasX t =&gt; HasY t where
  y_ :: RealFloat n =&gt; Lens' (t n) n
  y_ = xy_ . _y

  xy_ :: RealFloat n =&gt; Lens' (t n) (V2 n)

instance HasY v =&gt; HasY (Point v) where
  xy_ = lensP . xy_

instance HasY V2    where xy_ = _xy
instance HasY V3    where xy_ = _xy
instance HasY Polar where xy_ = polarV2

-- | Does not satify lens laws.
instance RealFloat n =&gt; PointLike V2 n (Polar n) where
  pointLike = _Point . from polarV2
  {-# INLINE pointLike #-}

</span></pre></body></html>