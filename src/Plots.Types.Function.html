<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable        #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts          #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances         #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses     #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes                #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards           #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies              #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies    #-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell           #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances      #-}</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving        #-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plots</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span><span class="hs-operator">.</span><span class="hs-identifier">Function</span><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Function plot options</span><span>
</span><a name="line-17"></a><span>    </span><a href="Plots.Types.Function.html#FunctionPlotOptions"><span class="hs-identifier hs-type">FunctionPlotOptions</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#functionPlotNumPoints"><span class="hs-identifier hs-var">functionPlotNumPoints</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-comment">-- , functionPlotSmooth</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-comment">-- , functionPlotDiscontinuous</span><span>
</span><a name="line-22"></a><span>  </span><span class="hs-comment">-- , mkFunctionPlot</span><span>
</span><a name="line-23"></a><span>  </span><span class="hs-comment">-- , _FunctionPlot</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-comment">-- , mkFunctionPlot</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-comment">-- , functionPlotFunction</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-comment">-- , functionPlotNumPoints</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-comment">-- , functionPlotSmooth</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-comment">-- , functionPlotDiscontinuous</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">-- , MeshPlot (..)</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-comment">-- , mkMeshPlot</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>  </span><span class="hs-comment">-- * Parametric plot</span><span>
</span><a name="line-35"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#ParametricPlot"><span class="hs-identifier hs-type">ParametricPlot</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#mkParametricPlot"><span class="hs-identifier hs-var">mkParametricPlot</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#parametricDomain"><span class="hs-identifier hs-var">parametricDomain</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#mkParametricRangePlot"><span class="hs-identifier hs-var">mkParametricRangePlot</span></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-comment">-- * Create line</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-special">,</span><a href="Plots.Types.Function.html#createABLine"><span class="hs-identifier hs-var">createABLine</span></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-special">,</span><a href="Plots.Types.Function.html#createHLine"><span class="hs-identifier hs-var">createHLine</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">,</span><a href="Plots.Types.Function.html#createVLine"><span class="hs-identifier hs-var">createVLine</span></a><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-comment">-- * Vector plot</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#VectorPlot"><span class="hs-identifier hs-type">VectorPlot</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#mkVectorPlot"><span class="hs-identifier hs-var">mkVectorPlot</span></a><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#mkVectorPointPlot"><span class="hs-identifier hs-var">mkVectorPointPlot</span></a><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>  </span><span class="hs-comment">-- * Vector plot lenses</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#setArrowOpts"><span class="hs-identifier hs-var">setArrowOpts</span></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span> </span><span class="hs-comment">-- * Parametric plot</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#parametricPlot"><span class="hs-identifier hs-var">parametricPlot</span></a><span>
</span><a name="line-55"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#parametricRangePlot"><span class="hs-identifier hs-var">parametricRangePlot</span></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#parametricPlot%27"><span class="hs-identifier hs-var">parametricPlot'</span></a><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#parametricRangePlot%27"><span class="hs-identifier hs-var">parametricRangePlot'</span></a><span>
</span><a name="line-58"></a><span>  </span><span class="hs-comment">-- , parametricPlotL</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-comment">-- , parametricRangePlotL</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>    </span><span class="hs-comment">-- * Line functions</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#abLinePlot"><span class="hs-identifier hs-var">abLinePlot</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#hLinePlot"><span class="hs-identifier hs-var">hLinePlot</span></a><span>
</span><a name="line-64"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#vLinePlot"><span class="hs-identifier hs-var">vLinePlot</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-comment">-- * Vectors</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#vectorPlot"><span class="hs-identifier hs-var">vectorPlot</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#vectorPointPlot"><span class="hs-identifier hs-var">vectorPointPlot</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#vectorPointPlot%27"><span class="hs-identifier hs-var">vectorPointPlot'</span></a><span>
</span><a name="line-70"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#vectorPointPlot%27%27"><span class="hs-identifier hs-var">vectorPointPlot''</span></a><span>
</span><a name="line-71"></a><span>  </span><span class="hs-comment">-- , vectorPointPlotL</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Plots.Types.Function.html#vectorFieldPlot"><span class="hs-identifier hs-var">vectorFieldPlot</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>  </span><span class="hs-comment">-- , meshPlot</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-comment">-- , surfacePlot</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Lens</span><span>                    </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lmap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">transform</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-operator hs-var">#</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">State</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Default</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Typeable</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Foldable</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">F</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span>           </span><a href="Diagrams.Coordinates.Isomorphic.html"><span class="hs-identifier">Diagrams</span><span class="hs-operator">.</span><span class="hs-identifier">Coordinates</span><span class="hs-operator">.</span><span class="hs-identifier">Isomorphic</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Diagrams</span><span class="hs-operator">.</span><span class="hs-identifier">Prelude</span><span>                </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">view</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span>           </span><a href="Plots.Style.html"><span class="hs-identifier">Plots</span><span class="hs-operator">.</span><span class="hs-identifier">Style</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span>           </span><a href="Plots.Types.html"><span class="hs-identifier">Plots</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span>           </span><a href="Plots.Axis.html"><span class="hs-identifier">Plots</span><span class="hs-operator">.</span><span class="hs-identifier">Axis</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">-- import           Data.Traversable  as T</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- import           Data.Foldable</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- import           Diagrams.BoundingBox</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- import           Diagrams.LinearMap</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- import           Linear.V3</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- import           Plots.Util</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- Function plot options</span><span>
</span><a name="line-102"></a><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-keyword">data</span><span> </span><a name="FunctionPlotOptions"><a href="Plots.Types.Function.html#FunctionPlotOptions"><span class="hs-identifier">FunctionPlotOptions</span></a></a><span> </span><a name="local-1628265965"><a href="#local-1628265965"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FunctionPlotOpts"><a href="Plots.Types.Function.html#FunctionPlotOpts"><span class="hs-identifier">FunctionPlotOpts</span></a></a><span>
</span><a name="line-105"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="_functionPlotNumPoints"><a href="Plots.Types.Function.html#_functionPlotNumPoints"><span class="hs-identifier">_functionPlotNumPoints</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-comment">--  , _functionPlotSmooth        :: Bool</span><span>
</span><a name="line-109"></a><span class="hs-comment">--  , _functionPlotDiscontinuous :: Maybe n</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-identifier hs-var">makeClassy</span><span> </span><span class="hs-char">''FunctionPlotOptions

instance Default (FunctionPlotOptions n) where
  def = FunctionPlotOpts
          { _functionPlotNumPoints     = 100
          }

--          , _functionPlotSmooth        = False
--          , _functionPlotDiscontinuous = Nothing

------------------------------------------------------------------------
-- Parametric plot
------------------------------------------------------------------------

data ParametricPlot v n = ParametricPlot
  { _parametricFunction    :: n -&gt; Point v n
  , _parametricDomain      :: (n, n)
  , _parametricPlotOptions :: FunctionPlotOptions n
   } deriving Typeable

makeLenses ''ParametricPlot

type instance V (ParametricPlot v n) = v
type instance N (ParametricPlot v n) = n

instance HasFunctionPlotOptions (ParametricPlot v n) n where
  functionPlotOptions = parametricPlotOptions

instance (Metric v, OrderedField n, Enum n) =&gt; Enveloped (ParametricPlot v n) where
  getEnvelope pa = getEnvelope p
                   where
                     p = map f [a, a + 1 / (pa ^. functionPlotNumPoints . to fromIntegral) .. b]
                     f = pa ^. parametricFunction
                     a = pa ^. parametricDomain . _1
                     b = pa ^. parametricDomain . _2

instance (TypeableFloat n, Enum n, Renderable (Path V2 n) b)
    =&gt; Plotable (ParametricPlot V2 n) b where
  renderPlotable s sty pa =
    pathFromVertices p
      # transform (s^.specTrans)
      # stroke
      # applyLineStyle sty
    where
      p = map f [a, a + 1 / (pa ^. functionPlotNumPoints . to fromIntegral) .. b]
      f = pa ^. parametricFunction
      a = pa ^. parametricDomain . _1
      b = pa ^. parametricDomain . _2

  defLegendPic sty ParametricPlot {..}
      = (p2 (-10,0) ~~ p2 (10,0))
          # applyLineStyle sty

pathFromVertices :: (Metric v, OrderedField n, Fractional (v n)) =&gt; [Point v n] -&gt; Path v n
pathFromVertices = cubicSpline False

-- | Create a parametric plot given a function on range (0,5).
mkParametricPlot :: (PointLike v n p, TypeableFloat n) =&gt; (n -&gt; p) -&gt; ParametricPlot v n
mkParametricPlot f
  = ParametricPlot
      { _parametricFunction = view unpointLike . f
      , _parametricDomain   = (0,5)
      , _parametricPlotOptions = def
      }

-- | Create a parametric plot given a function and a range.
mkParametricRangePlot :: PointLike v n p =&gt; (n -&gt; p) -&gt; (n, n)-&gt; ParametricPlot v n
mkParametricRangePlot f d
  = ParametricPlot
      { _parametricFunction = view unpointLike . f
      , _parametricDomain   = d
      , _parametricPlotOptions = def
      }

-- | Functions to create ab, vertical and horizontal lines.

createABLine :: Num n =&gt; n -&gt; n -&gt; n -&gt; P2 n
createABLine slope intercept x = p2 (x ,(slope*x) +  intercept)

createHLine :: n -&gt; n -&gt; P2 n
createHLine intercept x = p2 (x, intercept)

createVLine :: n -&gt; n -&gt; P2 n
createVLine intercept x = p2 (intercept, x)

------------------------------------------------------------------------
-- Vector Plot
------------------------------------------------------------------------

data VectorPlot v n = VectorPlot
   { _vectorV        :: v n
   , _vectorPoint   :: (n,n)
   , _vectorArrows  :: ArrowOpts n
   } deriving Typeable

makeLenses ''VectorPlot

type instance V (VectorPlot v n) = v
type instance N (VectorPlot v n) = n

instance (Metric v, OrderedField n) =&gt; Enveloped (VectorPlot v n) where
  getEnvelope = const mempty

instance (TypeableFloat n, Renderable (Path V2 n) b)
    =&gt; Plotable (VectorPlot V2 n) b where
  renderPlotable s _sty v = arrowAt' opts pt1 (V2 q r)
                          # transform (s^.specTrans)
                          # translate (r2 (x, y))
                          where
                             pt1      = p2 (x, y)
                             (x, y)   = v ^. vectorPoint
                             (V2 q r) = v ^. vectorV
                             opts     = v ^. vectorArrows

  defLegendPic sty VectorPlot {..}
      = (p2 (-10,0) ~~ p2 (10,0))
          # applyLineStyle sty

-- | Plot a given vector at (0,0).
mkVectorPlot :: TypeableFloat n =&gt; v n -&gt; VectorPlot v n
mkVectorPlot f
  = VectorPlot
      { _vectorV       = f
      , _vectorPoint   = (0,0)
      , _vectorArrows  = def
      }

-- | Plot a given vector at a given point.
mkVectorPointPlot :: TypeableFloat n =&gt; v n -&gt; (n, n) -&gt;VectorPlot v n
mkVectorPointPlot f d
  = VectorPlot
      { _vectorV       = f
      , _vectorPoint   = d
      , _vectorArrows  = def
      }

------------------------------------------------------------------------
-- Vector plot lenses
------------------------------------------------------------------------
class HasVector a v n | a -&gt; v n where
  vector :: Lens' a (VectorPlot v n)

  setArrowOpts :: Lens' a (ArrowOpts n)
  setArrowOpts = vector . lens _vectorArrows (\s b -&gt; (s {_vectorArrows = b}))

instance HasVector (VectorPlot v n) v n where
  vector = id

instance HasVector (Plot (VectorPlot v n) b) v n where
  vector = rawPlot

------------------------------------------------------------------------
-- Parametric Plot
------------------------------------------------------------------------

parametricPlot
  :: (v ~ BaseSpace c,
      PointLike v n p,
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b,
      TypeableFloat n)
  =&gt; (n -&gt; p) -&gt; State (Plot (ParametricPlot v n) b) () -&gt; m ()
parametricPlot f = addPlotable (mkParametricPlot f)

parametricPlot'
  :: (v ~ BaseSpace c,
      PointLike v n p,
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b,
      TypeableFloat n)
  =&gt; (n -&gt; p) -&gt; m ()
parametricPlot' f = addPlotable' (mkParametricPlot f)

-- parametricPlotL
--   :: (v ~ BaseSpace c,
--       PointLike v n p,
--       MonadState (Axis b c n) m,
--       Plotable (ParametricPlot v n) b,
--       Additive v, TypeableFloat n)
--   =&gt; String -&gt; (n -&gt; p) -&gt; m ()
-- parametricPlotL l f = addPlotableL l (mkParametricPlot f)

-- range variant

parametricRangePlot
  :: (v ~ BaseSpace c,
      PointLike v n p,
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b)
  =&gt; (n -&gt; p) -&gt; (n ,n) -&gt; State (Plot (ParametricPlot v n) b) () -&gt; m ()
parametricRangePlot f d = addPlotable (mkParametricRangePlot f d)

parametricRangePlot'
  :: (v ~ BaseSpace c,
      PointLike v n p,
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b)
  =&gt; (n -&gt; p) -&gt; (n ,n) -&gt; m ()
parametricRangePlot' f d = addPlotable' (mkParametricRangePlot f d)

-- parametricRangePlotL
--   :: (v ~ BaseSpace c,
--       PointLike v n p,
--       MonadState (Axis b c n) m,
--       Plotable (ParametricPlot v n) b,
--       Additive v, TypeableFloat n)
--   =&gt; String -&gt; (n -&gt; p) -&gt; (n ,n) -&gt; m ()
-- parametricRangePlotL l f d = addPlotableL l (mkParametricRangePlot f d)

------------------------------------------------------------------------
-- Vector Plot
------------------------------------------------------------------------

vectorPlot
  :: (v ~ BaseSpace c,
      MonadState (Axis b c n) m,
      Plotable (VectorPlot v n) b,
      TypeableFloat n)
  =&gt;  v n -&gt; State (Plot (VectorPlot v n) b) () -&gt; m ()
vectorPlot f = addPlotable (mkVectorPlot f)

vectorPointPlot
  :: (v ~ BaseSpace c,
      MonadState (Axis b c n) m,
      Plotable (VectorPlot v n) b,
      TypeableFloat n)
  =&gt;  v n -&gt; (n, n) -&gt; State (Plot (VectorPlot v n) b) () -&gt; m ()
vectorPointPlot f d = addPlotable (mkVectorPointPlot f d)

vectorPointPlot'
  :: (v ~ BaseSpace c,
      MonadState (Axis b c n) m,
      Plotable (VectorPlot v n) b,
      TypeableFloat n)
  =&gt;  v n -&gt; (n, n) -&gt; m ()
vectorPointPlot' f d = addPlotable' (mkVectorPointPlot f d)

vectorPointPlot''
  :: (v ~ BaseSpace c,
      MonadState (Axis b c n) m,
      Plotable (VectorPlot v n) b,
      TypeableFloat n)
  =&gt;  v n -&gt; (n, n) -&gt; ArrowOpts n -&gt; m ()
vectorPointPlot'' f d opts = addPlotable (mkVectorPointPlot f d) $ do
                              setArrowOpts .= opts

-- vectorPointPlotL
--   :: (v ~ BaseSpace c,
--       MonadState (Axis b c n) m,
--       Plotable (VectorPlot v n) b,
--       Additive v, TypeableFloat n)
--   =&gt;  String -&gt; v n -&gt; (n, n) -&gt; m ()
-- vectorPointPlotL l f d = addPlotableL l (mkVectorPointPlot f d)

vectorFieldPlot
  :: (v ~ BaseSpace c,
      MonadState (Axis b c n) m,
      Plotable (VectorPlot v n) b,
      TypeableFloat n)
  =&gt;  [v n] -&gt; [(n, n)] -&gt; ArrowOpts n -&gt; m ()
vectorFieldPlot vs ps opts =
  F.forM_ (zip vs ps) $ \x -&gt;
    vectorPointPlot'' (fst x) (snd x) opts

-------------------------------------------------------------------------------
-- Line
-------------------------------------------------------------------------------

abLinePlot
  :: (v ~ BaseSpace c,
      PointLike v n (P2 n),
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b,
      Additive v, TypeableFloat n)
     =&gt; n -&gt; n -&gt; (n ,n) -&gt; State (Plot (ParametricPlot v n) b) () -&gt; m ()
abLinePlot slope intercept d = addPlotable (mkParametricRangePlot (createABLine slope intercept) d)

hLinePlot
  :: (v ~ BaseSpace c,
      PointLike v n (P2 n),
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b,
      Additive v, TypeableFloat n)
     =&gt; n -&gt; (n ,n) -&gt; State (Plot (ParametricPlot v n) b) () -&gt; m ()
hLinePlot intercept d = addPlotable (mkParametricRangePlot (createHLine intercept) d)

vLinePlot
  :: (v ~ BaseSpace c,
      PointLike v n (P2 n),
      MonadState (Axis b c n) m,
      Plotable (ParametricPlot v n) b,
      Additive v, TypeableFloat n)
     =&gt; n -&gt; (n ,n) -&gt; State (Plot (ParametricPlot v n) b) () -&gt; m ()
vLinePlot intercept d = addPlotable (mkParametricRangePlot (createVLine intercept) d)

------------------------------------------------------------------------

-- data FunctionPlot n = FunctionPlot
--   { _functionPlotFunction :: n -&gt; n
--   , _functionPlotOpts     :: FunctionPlotOptions n
--   , _functionDomain       :: (n,n)
--   } deriving Typeable

-- makeLenses ''FunctionPlot

-- instance HasFunctionPlotOptions (FunctionPlot n) n where
--   functionPlotOptions = functionPlotOpts

-- type instance V (FunctionPlot n) = V2
-- type instance N (FunctionPlot n) = n

-- -- do I really need a default instance for this?
-- instance (TypeableFloat n) =&gt; Default (FunctionPlot n) where
--   def = FunctionPlot { _functionPlotFunction = const 0
--                      , _functionDomain       = (0,5)
--                      , _functionPlotOpts     = def
--                      }

-- -- pathFromVertices :: [Point v n] -&gt; Path v n
-- -- pathFromVertices = fromVertices



-- -- drawFunctionPlot :: Renderable (Path V2 n) b =&gt; T2 n -&gt; FunctionPlot b V2 n -&gt; Diagram b V2 n
-- -- drawFunctionPlot t fp = fromVertices functionPath
-- --                           # transform t
-- --                           # applyStyle (fp ^. themeLineStyle)
-- --   where
-- --     functionPath = map f [a, a + 1 / (fp ^. functionPlotNumPoints . to fromIntegral) .. b]
-- --     f            = fp ^. functionPlotFunction
-- --     a            = fp ^. plotBounds . el ex . lowerBound . recommend
-- --     b            = fp ^. plotBounds . el ex . upperBound . recommend

-- instance (Typeable b, TypeableFloat n, Enum n, Renderable (Path V2 n) b) =&gt; Plotable (FunctionPlot n) b where
--   renderPlotable pp _ tv l t2 fp =
--     path # transform tv
--          # lmap l
--          # transform t2
--          # stroke
--          # applyStyle (pp ^. themeLineStyle)
--     where
--       path = pathFromVertices $ map (mkP2 &lt;*&gt; f) [a, a + 1 / (fp ^. functionPlotNumPoints . to fromIntegral) .. b]
--       --
--       f = fp ^. functionPlotFunction
--       (a,b) = fp ^. functionDomain -- getBound ex fp


-- -- _FunctionPlot :: Plotable (FunctionPlot n) b =&gt; Prism' (Plot b V2 n) (FunctionPlot n)
-- -- _FunctionPlot = _Plot

-- mkFunctionPlot :: (TypeableFloat n) =&gt; (n,n) -&gt; (n -&gt; n) -&gt; FunctionPlot n
-- mkFunctionPlot d f = def &amp; functionPlotFunction .~ f
--                          &amp; functionDomain       .~ d


-- ------------------------------------------------------------------------
-- -- Vector field
-- ------------------------------------------------------------------------

-- data VectorField v n = VectorField
--   { _fieldGrad         :: v n -&gt; v n
--   , _fieldPoints       :: BoundingBox v n -&gt; [Point v n]
--   , _vectorFieldArrows :: ArrowOpts n
--   }

-- -- makeLenses ''VectorField

-- mkVectorField :: (VectorLike v n vn, TypeableFloat n) =&gt; (vn -&gt; vn) -&gt; VectorField v n
-- mkVectorField f
--   = VectorField
--       { _fieldGrad   = over vectorLike f
--       , _fieldPoints = splitBoundingBox (10 &lt;$ (zero :: Additive v =&gt; v Int))
--       , _vectorFieldArrows = def
--       }

-- splitBoundingBox :: (Additive v, Traversable v, Fractional n)
--   =&gt; v Int -&gt; BoundingBox v n -&gt; [Point v n]
-- splitBoundingBox xs = maybe [] mkPoints . getCorners
--   where
--     mkPoints (l,u) = T.sequence (liftI3 enumFromToN l u (P xs))

-- (&lt;~&gt;) :: Additive v =&gt; v (a -&gt; b) -&gt; v a -&gt; v b
-- (&lt;~&gt;) = liftI2 ($)
-- {-# INLINE (&lt;~&gt;) #-}

-- infixl 4 &lt;~&gt;

-- liftI3 :: Additive f =&gt; (a -&gt; b -&gt; c -&gt; d) -&gt; f a -&gt; f b -&gt; f c -&gt; f d
-- liftI3 f a b c = liftI2 f a b &lt;~&gt; c
-- {-# INLINE liftI3 #-}

------------------------------------------------------------------------
-- Mesh plot
------------------------------------------------------------------------

-- data MeshPlot n = MeshPlot
--   { _meshFunction    :: n -&gt; n -&gt; n -- ^ $\x y -&gt; z$
--   , _meshDomain      :: V2 (n, n)
--   -- , _meshPlotOptions :: FunctionPlotOptions b R3
--   } deriving Typeable

-- type instance V (MeshPlot n) = V3
-- type instance N (MeshPlot n) = n

-- makeLenses ''MeshPlot


-- instance HasGenericPlot (MeshPlot b n) where
--   genericPlot = meshPlotGeneric

-- instance HasFunctionPlotOptions (MeshPlot b) b R3 where
--   functionPlotOptions = meshPlotOptions

-- instance (Typeable b, TypeableFloat n, Enum n, Renderable (Path V2 n) b)
--     =&gt; Plotable (MeshPlot n) b where
--   renderPlotable pp _ tv l t2 mp =
--     path # transform t
--          # stroke
--          # applyStyle (pp ^. themeLineStyle)
--     where
--       path = foldMap xlines xs &lt;&gt; foldMap ylines ys
--       --
--       f = mp ^. meshFunction
--       xlines x = pathFromVertices [ mkP3 x y (f x y) | y &lt;- ys ]
--       ylines y = pathFromVertices [ mkP3 x y (f x y) | x &lt;- xs ]
--       --
--       xs = [xa, xa + (xb - xa) / n .. xb]
--       ys = [ya, ya + (xb - xa) / n .. yb]
--       (xa,xb) = mp ^. meshDomain . el ex
--       (ya,yb) = mp ^. meshDomain . el ey
--       -- n = mp ^. functionPlotNumPoints . to fromIntegral
--       n = 15

-- mkMeshPlot :: (TypeableFloat n) =&gt; (n -&gt; n -&gt; n) -&gt; MeshPlot n
-- mkMeshPlot f = def &amp; meshFunction .~ f
</span></pre></body></html>